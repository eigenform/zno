<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Next-Fetch Prediction - ZNO Microarchitecture</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../intro.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Implementation</li><li class="chapter-item expanded "><a href="../front/frontend.html"><strong aria-hidden="true">1.</strong> ZNO Frontend</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../front/cfe.html"><strong aria-hidden="true">1.1.</strong> Control-flow</a></li><li class="chapter-item expanded "><a href="../front/nfpred.html" class="active"><strong aria-hidden="true">1.2.</strong> Next-Fetch Prediction</a></li><li class="chapter-item expanded "><a href="../front/fetch.html"><strong aria-hidden="true">1.3.</strong> Instruction Fetch</a></li><li class="chapter-item expanded "><a href="../front/predecode.html"><strong aria-hidden="true">1.4.</strong> Instruction Predecode</a></li><li class="chapter-item expanded "><a href="../front/decode.html"><strong aria-hidden="true">1.5.</strong> Instruction Decode</a></li><li class="chapter-item expanded "><a href="../front/bpred.html"><strong aria-hidden="true">1.6.</strong> Branch Prediction</a></li></ol></li><li class="chapter-item expanded "><a href="../mid/midcore.html"><strong aria-hidden="true">2.</strong> ZNO Midcore</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../mid/rename.html"><strong aria-hidden="true">2.1.</strong> Register Renaming</a></li><li class="chapter-item expanded "><a href="../mid/dispatch.html"><strong aria-hidden="true">2.2.</strong> Instruction Dispatch</a></li></ol></li><li class="chapter-item expanded "><a href="../back/backend.html"><strong aria-hidden="true">3.</strong> ZNO Backend</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../back/sched.html"><strong aria-hidden="true">3.1.</strong> Instruction Scheduling</a></li><li class="chapter-item expanded "><a href="../back/integer.html"><strong aria-hidden="true">3.2.</strong> Integer Pipeline</a></li><li class="chapter-item expanded "><a href="../back/ldst.html"><strong aria-hidden="true">3.3.</strong> Load/Store Pipeline</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ZNO Microarchitecture</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="next-fetch-prediction"><a class="header" href="#next-fetch-prediction">Next-Fetch Prediction</a></h1>
<p>Ideally, instruction fetch is constantly producing an uninterrupted stream of 
fetch blocks which contain the correct, architecturally-relevant path. 
In order to approach this goal, each address sent to instruction fetch must 
also be subject to a <strong>next-fetch prediction</strong>. </p>
<p>Ideally, this occurs <em>immediately</em> when the machine obtains the next 
program counter value - otherwise, pipeline bubbles will occur as the machine
becomes starved for instructions.</p>
<h2 id="control-flow-map-cfm"><a class="header" href="#control-flow-map-cfm">&quot;Control-flow Map&quot; (CFM)</a></h2>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="#admonition-note"></a></p>
</div>
<div>
<ul>
<li>This is a somewhat aggressive solution?? There's probably a more relaxed 
version of this where we only handle certain &quot;easy&quot; cases. </li>
<li>This can probably be used to store certain predictions alongside branch
information</li>
<li>To what degree do we want <em>speculative</em> control-flow events to be subject to 
next-fetch prediction?</li>
<li>You can probably use this to create some kind of basic-block map by
counting fetch blocks which contain no branches?</li>
</ul>
</div>
</div>
<p>A <strong>control-flow map</strong> (CFM) is indexed by fetch block address and stores 
previously-discovered control-flow information about the contents of a fetch 
block. When a fetch block contains branches, a corresponding CFM entry may 
be filled by the output of instruction predecode. </p>
<p>The CFM is used to predict <em>the existence of an instruction</em> within a fetch 
block that will result in a control-flow event <strong>and</strong> predict the associated
target address. In this way, a CFM entry can be used to obtain the address 
of the next-expected fetch block while the previous is being fetched. </p>
<ol>
<li>
<p>All control-flow events have an associated target (program counter value).
The corresponding fetch block address is used to access the CFM while
simultaneously being sent to the instruction fetch unit.</p>
</li>
<li>
<p>When a CFM miss occurs, an informed prediction cannot be made in-parallel 
with instruction fetch. </p>
</li>
<li>
<p>When a CFM hit occurs, the contents of the entry are used to make a new 
prediction in parallel with instruction fetch. This may involve accessing 
storage for other branch prediction structures. </p>
</li>
<li>
<p>After instruction fetch and predecode have completed, the contents of a
CFM hit are validated against the newly-predecoded fetch block. 
If predecode output does not match the branches cached by the CFM entry, the 
entry must be updated to reflect the fact that the contents of the fetch block
have apparently changed. This must also invalidate any prediction made with
the now-invalid cached branch information.</p>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../front/cfe.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../front/fetch.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../front/cfe.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../front/fetch.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
